(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[983],{35695:(e,t,r)=>{"use strict";var a=r(18999);r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}})},40283:(e,t,r)=>{"use strict";r.d(t,{A:()=>c,O:()=>i});var a=r(95155),n=r(12115),s=r(35695);let o=(0,n.createContext)(void 0),l="http://localhost:8000";function i(e){let{children:t}=e,[r,i]=(0,n.useState)(null),[c,u]=(0,n.useState)(!0),d=(0,s.useRouter)();(0,n.useEffect)(()=>{let e=localStorage.getItem("accessToken");e?m(e):u(!1)},[]);let m=async e=>{try{let t=await fetch("".concat(l,"/api/v1/auth/me"),{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();i(e)}else localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken")}catch(e){console.error("Failed to fetch user:",e)}finally{u(!1)}},h=async(e,t)=>{let r=await fetch("".concat(l,"/api/v1/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(!r.ok)throw Error((await r.json()).detail||"Login failed");let a=await r.json();localStorage.setItem("accessToken",a.access_token),localStorage.setItem("refreshToken",a.refresh_token),await m(a.access_token),d.push("/")},g=async(e,t,r,a)=>{let n=await fetch("".concat(l,"/api/v1/auth/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,email:t,password:r,full_name:a,role:"citizen"})});if(!n.ok)throw Error((await n.json()).detail||"Registration failed");await h(t,r)},p=async()=>{let e=localStorage.getItem("accessToken");e&&await m(e)};return(0,a.jsx)(o.Provider,{value:{user:r,isAuthenticated:!!r,isLoading:c,login:h,register:g,logout:()=>{localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),i(null),d.push("/auth/login")},refreshUser:p},children:t})}function c(){let e=(0,n.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},56117:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var a=r(95155),n=r(12115),s=r(35695),o=r(6874),l=r.n(o),i=r(40283);function c(){let[e,t]=(0,n.useState)({username:"",email:"",password:"",confirmPassword:"",full_name:""}),[r,o]=(0,n.useState)(""),[c,u]=(0,n.useState)(!1),{register:d}=(0,i.A)();(0,s.useRouter)();let m=r=>{t({...e,[r.target.name]:r.target.value})},h=async t=>{if(t.preventDefault(),o(""),e.password!==e.confirmPassword){o("Mật khẩu kh\xf4ng khớp");return}if(e.password.length<8){o("Mật khẩu phải c\xf3 \xedt nhất 8 k\xfd tự");return}u(!0);try{await d(e.username,e.email,e.password,e.full_name||void 0)}catch(e){o(e.message||"Đăng k\xfd thất bại")}finally{u(!1)}};return(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-green-50 to-blue-50 px-4 py-12",children:(0,a.jsxs)("div",{className:"max-w-md w-full space-y-8 bg-white p-8 rounded-2xl shadow-xl",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h2",{className:"text-3xl font-bold text-gray-900",children:"Đăng k\xfd t\xe0i khoản"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"Tham gia cộng đồng GreenEduMap"})]}),r&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:(0,a.jsx)("p",{className:"text-sm",children:r})}),(0,a.jsxs)("form",{className:"mt-8 space-y-6",onSubmit:h,children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 mb-2",children:"T\xean đăng nhập *"}),(0,a.jsx)("input",{id:"username",name:"username",type:"text",required:!0,minLength:3,maxLength:50,value:e.username,onChange:m,className:"appearance-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"username123"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"full_name",className:"block text-sm font-medium text-gray-700 mb-2",children:"Họ v\xe0 t\xean"}),(0,a.jsx)("input",{id:"full_name",name:"full_name",type:"text",value:e.full_name,onChange:m,className:"appearance-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Nguyễn Văn A"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email *"}),(0,a.jsx)("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:e.email,onChange:m,className:"appearance-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"your@email.com"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Mật khẩu * (tối thiểu 8 k\xfd tự)"}),(0,a.jsx)("input",{id:"password",name:"password",type:"password",autoComplete:"new-password",required:!0,minLength:8,value:e.password,onChange:m,className:"appearance-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"••••••••"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:"X\xe1c nhận mật khẩu *"}),(0,a.jsx)("input",{id:"confirmPassword",name:"confirmPassword",type:"password",autoComplete:"new-password",required:!0,value:e.confirmPassword,onChange:m,className:"appearance-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"••••••••"})]})]}),(0,a.jsx)("button",{type:"submit",disabled:c,className:"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-lg text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:c?"Đang đăng k\xfd...":"Đăng k\xfd"}),(0,a.jsx)("div",{className:"text-center",children:(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Đ\xe3 c\xf3 t\xe0i khoản?"," ",(0,a.jsx)(l(),{href:"/auth/login",className:"font-medium text-green-600 hover:text-green-500",children:"Đăng nhập"})]})}),(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)(l(),{href:"/",className:"text-sm text-gray-500 hover:text-gray-700",children:"← Quay lại trang chủ"})})]})]})})}},63381:(e,t,r)=>{Promise.resolve().then(r.bind(r,56117))}},e=>{var t=t=>e(e.s=t);e.O(0,[6874,8441,1684,7358],()=>t(63381)),_N_E=e.O()}]);
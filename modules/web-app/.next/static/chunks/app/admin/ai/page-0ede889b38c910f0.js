(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[209],{16256:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>F});var n=a(95155),s=a(12115),l=a(67426),r=a(49376),o=a(55607),i=a(48691),c=a(57340),d=a(4648),h=a(84109),u=a(33917),x=a(41407),m=a(46788),g=a(71381),_=a(16957),b=a(75455),y=a(43027),j=a(60852),p=a(47457),f=a(83540),w=a(93504),v=a(94754),k=a(96025),N=a(16238),C=a(94517),A=a(24026),T=a(21374),L=a(3401),S=a(58227);function M(e){let{data:t,type:a="bar"}=e,s=t.slice(0,10).map(e=>({name:e.tinh_thanh,"Thực phẩm":e.du_doan_nhu_cau_thuc_pham,Nước:e.du_doan_nhu_cau_nuoc,Thuốc:e.du_doan_nhu_cau_thuoc,"Chỗ ở":e.du_doan_nhu_cau_cho_o}));return"line"===a?(0,n.jsx)(f.u,{width:"100%",height:"100%",children:(0,n.jsxs)(w.b,{data:s,children:[(0,n.jsx)(v.d,{strokeDasharray:"3 3"}),(0,n.jsx)(k.W,{dataKey:"name"}),(0,n.jsx)(N.h,{}),(0,n.jsx)(C.m,{}),(0,n.jsx)(A.s,{}),(0,n.jsx)(T.N,{type:"monotone",dataKey:"Thực phẩm",stroke:"#2E7D32"}),(0,n.jsx)(T.N,{type:"monotone",dataKey:"Nước",stroke:"#1976D2"}),(0,n.jsx)(T.N,{type:"monotone",dataKey:"Thuốc",stroke:"#D32F2F"}),(0,n.jsx)(T.N,{type:"monotone",dataKey:"Chỗ ở",stroke:"#FF9800"})]})}):(0,n.jsx)(f.u,{width:"100%",height:"100%",children:(0,n.jsxs)(L.E,{data:s,children:[(0,n.jsx)(v.d,{strokeDasharray:"3 3"}),(0,n.jsx)(k.W,{dataKey:"name"}),(0,n.jsx)(N.h,{}),(0,n.jsx)(C.m,{}),(0,n.jsx)(A.s,{}),(0,n.jsx)(S.y,{dataKey:"Thực phẩm",fill:"#2E7D32"}),(0,n.jsx)(S.y,{dataKey:"Nước",fill:"#1976D2"}),(0,n.jsx)(S.y,{dataKey:"Thuốc",fill:"#D32F2F"}),(0,n.jsx)(S.y,{dataKey:"Chỗ ở",fill:"#FF9800"})]})})}var K=a(32960),E=a(57451);let D={"Lũ lụt":"Lũ lụt",Bão:"B\xe3o","Hạn h\xe1n":"Hạn h\xe1n","Sạt lở đất":"Sạt lở đất","Động đất":"Động đất","Ch\xe1y rừng":"Ch\xe1y rừng"};function F(){let[e,t]=(0,s.useState)("all"),[a,f]=(0,s.useState)(!1),[w,v]=(0,s.useState)(null),[k,N]=(0,s.useState)(""),{data:C,isLoading:A,refetch:T}=function(e,t){let{error:a}=(0,E.useToast)(),n=new URLSearchParams;return e&&n.append("tinh_thanh",e),t&&n.append("generate","true"),(0,K.I)({queryKey:["ai-predictions",e,t],queryFn:async()=>{let e=await fetch("/api/ai?".concat(n.toString()));if(!e.ok)throw Error((await e.json().catch(()=>({}))).error||"Lỗi khi tải dự b\xe1o AI");return e.json()}})}("all"!==e?e:void 0,a),L=(0,s.useMemo)(()=>C&&(null==C?void 0:C.predictions)||[],[C]),S=(0,s.useMemo)(()=>{if(!k.trim())return L;let e=k.toLowerCase();return L.filter(t=>t.tinh_thanh.toLowerCase().includes(e)||t.loai_thien_tai.toLowerCase().includes(e)||(D[t.loai_thien_tai]||"").toLowerCase().includes(e))},[L,k]),F=(0,s.useMemo)(()=>Array.from(new Set(L.map(e=>e.tinh_thanh))).map(e=>({value:e,label:e})),[L]),I=(0,s.useMemo)(()=>Object.values(L.reduce((e,t)=>{let a=t.tinh_thanh;return e[a]||(e[a]={id:0,tinh_thanh:a,loai_thien_tai:"",du_doan_nhu_cau_thuc_pham:0,du_doan_nhu_cau_nuoc:0,du_doan_nhu_cau_thuoc:0,du_doan_nhu_cau_cho_o:0,ngay_du_bao:t.ngay_du_bao}),e[a].du_doan_nhu_cau_thuc_pham+=t.du_doan_nhu_cau_thuc_pham,e[a].du_doan_nhu_cau_nuoc+=t.du_doan_nhu_cau_nuoc,e[a].du_doan_nhu_cau_thuoc+=t.du_doan_nhu_cau_thuoc,e[a].du_doan_nhu_cau_cho_o+=t.du_doan_nhu_cau_cho_o,e},{})).sort((e,t)=>e.tinh_thanh.localeCompare(t.tinh_thanh)),[L]),z=(0,s.useMemo)(()=>{if(0===L.length)return{total:0,topFood:0,topWater:0,topShelter:0};let e=Math.max(...L.map(e=>e.du_doan_nhu_cau_thuc_pham)),t=Math.max(...L.map(e=>e.du_doan_nhu_cau_nuoc)),a=Math.max(...L.map(e=>e.du_doan_nhu_cau_cho_o));return{total:L.length,topFood:e,topWater:t,topShelter:a}},[L]),B=(0,s.useMemo)(()=>[{key:"tinh_thanh",label:"Tỉnh th\xe0nh"},{key:"loai_thien_tai",label:"Thi\xean tai",render:e=>D[e]||e},{key:"du_doan_nhu_cau_thuc_pham",label:"Thực phẩm",render:e=>e.toLocaleString()},{key:"du_doan_nhu_cau_nuoc",label:"Nước",render:e=>e.toLocaleString()},{key:"du_doan_nhu_cau_thuoc",label:"Thuốc",render:e=>e.toLocaleString()},{key:"du_doan_nhu_cau_cho_o",label:"Chỗ ở",render:e=>e.toLocaleString()},{key:"ngay_du_bao",label:"Ng\xe0y dự b\xe1o",render:e=>(0,l.GP)(new Date(e),"dd/MM/yyyy")},{key:"actions",label:"Thao t\xe1c",render:(e,t)=>(0,n.jsx)(j.A,{size:"sm",variant:"outline",onClick:()=>v(t),children:"Chi tiết"})}],[]);return(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsx)(x.A,{title:"Dự b\xe1o AI",description:"Ph\xe2n t\xedch v\xe0 dự đo\xe1n nhu cầu cứu trợ theo khu vực",actions:[{label:a?"Đang hiển thị dữ liệu giả lập":"Hiển thị dữ liệu giả lập",variant:"outline",onClick:()=>f(e=>!e)}]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-4",children:[(0,n.jsx)(m.A,{title:"Tổng dự b\xe1o",value:z.total,icon:r.A,color:"blue",description:"Bản ghi dự b\xe1o đang theo d\xf5i"}),(0,n.jsx)(m.A,{title:"Nhu cầu thực phẩm",value:z.topFood,icon:o.A,color:"red",description:"Nhu cầu cao nhất (kg)"}),(0,n.jsx)(m.A,{title:"Nhu cầu nước",value:z.topWater,icon:i.A,color:"blue",description:"Nhu cầu cao nhất (l\xedt)"}),(0,n.jsx)(m.A,{title:"Nhu cầu chỗ ở",value:z.topShelter,icon:c.A,color:"orange",description:"Số hộ cần hỗ trợ chỗ ở"})]}),A?(0,n.jsx)(b.A,{variant:"section",label:"Đang tải dự b\xe1o AI...",className:"min-h-[320px]"}):0===L.length?(0,n.jsx)(y.A,{icon:(0,n.jsx)(d.A,{className:"h-6 w-6","aria-hidden":!0}),title:"Chưa c\xf3 dữ liệu dự b\xe1o",description:"H\xe3y chạy m\xf4 h\xecnh AI hoặc bật chế độ giả lập để xem thử.",action:(0,n.jsx)(j.A,{onClick:()=>f(!0),startIcon:(0,n.jsx)(h.A,{className:"h-4 w-4"}),children:"Hiển thị dữ liệu giả lập"})}):(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsx)("section",{className:"rounded-2xl border border-gray-200 bg-white p-4 shadow-sm dark:border-white/[0.08] dark:bg-gray-900/60",children:(0,n.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[(0,n.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[(0,n.jsx)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Lọc theo tỉnh th\xe0nh:"}),(0,n.jsx)("div",{className:"w-full sm:w-64",children:(0,n.jsx)(p.A,{options:[{value:"all",label:"Tất cả tỉnh th\xe0nh"},...F],placeholder:"Chọn tỉnh th\xe0nh",onChange:e=>t(e),defaultValue:e})})]}),(0,n.jsx)(j.A,{size:"sm",variant:"outline",onClick:()=>T(),startIcon:(0,n.jsx)(h.A,{className:"h-4 w-4"}),children:"Tải lại dữ liệu"})]})}),(0,n.jsxs)("section",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:[(0,n.jsxs)("div",{className:"rounded-2xl border border-gray-200 bg-white p-6 shadow-sm dark:border-white/[0.08] dark:bg-gray-900/60",children:[(0,n.jsx)("div",{className:"mb-4 flex items-center justify-between",children:(0,n.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Nhu cầu tổng hợp"})}),(0,n.jsx)("div",{className:"h-80",children:(0,n.jsx)(M,{data:L.slice(0,10),type:"bar"})})]}),(0,n.jsxs)("div",{className:"rounded-2xl border border-gray-200 bg-white p-6 shadow-sm dark:border-white/[0.08] dark:bg-gray-900/60",children:[(0,n.jsx)("div",{className:"mb-4 flex items-center justify-between",children:(0,n.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Dự b\xe1o theo tỉnh th\xe0nh"})}),(0,n.jsx)("div",{className:"h-80",children:I.length>0?(0,n.jsx)(M,{data:I,type:"line"}):(0,n.jsx)("div",{className:"flex h-full items-center justify-center text-sm text-gray-500 dark:text-gray-400",children:"Kh\xf4ng c\xf3 dữ liệu để hiển thị"})})]})]}),(0,n.jsxs)("section",{className:"space-y-4",children:[(0,n.jsx)("div",{className:"flex items-center justify-between",children:(0,n.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Bảng dữ liệu dự b\xe1o"})}),(0,n.jsx)(g.A,{columns:B,data:S,searchable:!0,searchPlaceholder:"T\xecm theo tỉnh th\xe0nh hoặc loại thi\xean tai...",onSearch:N,emptyMessage:"Kh\xf4ng c\xf3 dữ liệu dự b\xe1o"})]})]}),(0,n.jsx)(_.A,{isOpen:!!w,onClose:()=>v(null),title:w?"".concat(w.tinh_thanh," - ").concat(D[w.loai_thien_tai]||w.loai_thien_tai):"Chi tiết dự b\xe1o",description:w?"Ng\xe0y dự b\xe1o: ".concat((0,l.GP)(new Date(w.ngay_du_bao),"dd/MM/yyyy")):void 0,size:"md",className:"max-h-[80vh]",children:w?(0,n.jsxs)("div",{className:"space-y-4 text-sm text-gray-700 dark:text-gray-200",children:[(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("p",{className:"font-medium",children:"Tỉnh th\xe0nh"}),(0,n.jsx)("p",{children:w.tinh_thanh})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,n.jsx)(P,{icon:o.A,label:"Thực phẩm",value:w.du_doan_nhu_cau_thuc_pham,suffix:"kg"}),(0,n.jsx)(P,{icon:i.A,label:"Nước",value:w.du_doan_nhu_cau_nuoc,suffix:"l\xedt"}),(0,n.jsx)(P,{icon:u.A,label:"Thuốc",value:w.du_doan_nhu_cau_thuoc,suffix:"đơn vị"}),(0,n.jsx)(P,{icon:c.A,label:"Chỗ ở",value:w.du_doan_nhu_cau_cho_o,suffix:"hộ"})]})]}):(0,n.jsx)(y.A,{icon:(0,n.jsx)(r.A,{className:"h-6 w-6","aria-hidden":!0}),title:"Kh\xf4ng c\xf3 dữ liệu",description:"Chọn một bản ghi từ bảng để xem chi tiết.",variant:"subtle",compact:!0})})]})}function P(e){let{icon:t,label:a,value:s,suffix:l}=e;return(0,n.jsxs)("div",{className:"flex items-center gap-3 rounded-xl border border-gray-200 bg-white p-4 dark:border-white/[0.08] dark:bg-gray-900/60",children:[(0,n.jsx)("div",{className:"rounded-lg bg-blue-100 p-2 text-blue-600 dark:bg-blue-900/40 dark:text-blue-400",children:(0,n.jsx)(t,{className:"h-5 w-5"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a}),(0,n.jsxs)("p",{className:"text-base font-semibold text-gray-900 dark:text-white",children:[s.toLocaleString()," ",l]})]})]})}},16957:(e,t,a)=>{"use strict";a.d(t,{A:()=>o});var n=a(95155),s=a(12115);let l=e=>{let{isOpen:t,onClose:a,children:l,className:r,showCloseButton:o=!0,isFullscreen:i=!1}=e,c=(0,s.useRef)(null);return((0,s.useEffect)(()=>{let e=e=>{"Escape"===e.key&&a()};return t&&document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[t,a]),(0,s.useEffect)(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[t]),t)?(0,n.jsxs)("div",{className:"fixed inset-0 flex items-center justify-center overflow-y-auto modal z-99999",children:[!i&&(0,n.jsx)("div",{className:"fixed inset-0 h-full w-full bg-gray-400/50 backdrop-blur-[32px]",onClick:a}),(0,n.jsxs)("div",{ref:c,className:"".concat(i?"w-full h-full":"relative w-full rounded-3xl bg-white  dark:bg-gray-900","  ").concat(r),onClick:e=>e.stopPropagation(),children:[o&&(0,n.jsx)("button",{onClick:a,className:"absolute right-3 top-3 z-999 flex h-9.5 w-9.5 items-center justify-center rounded-full bg-gray-100 text-gray-400 transition-colors hover:bg-gray-200 hover:text-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white sm:right-6 sm:top-6 sm:h-11 sm:w-11",children:(0,n.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.04289 16.5413C5.65237 16.9318 5.65237 17.565 6.04289 17.9555C6.43342 18.346 7.06658 18.346 7.45711 17.9555L11.9987 13.4139L16.5408 17.956C16.9313 18.3466 17.5645 18.3466 17.955 17.956C18.3455 17.5655 18.3455 16.9323 17.955 16.5418L13.4129 11.9997L17.955 7.4576C18.3455 7.06707 18.3455 6.43391 17.955 6.04338C17.5645 5.65286 16.9313 5.65286 16.5408 6.04338L11.9987 10.5855L7.45711 6.0439C7.06658 5.65338 6.43342 5.65338 6.04289 6.0439C5.65237 6.43442 5.65237 7.06759 6.04289 7.45811L10.5845 11.9997L6.04289 16.5413Z",fill:"currentColor"})})}),(0,n.jsx)("div",{children:l})]})]}):null},r={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"};function o(e){let{isOpen:t,onClose:a,title:s,description:o,children:i,footer:c,size:d="lg",hideCloseButton:h=!1,className:u=""}=e;return(0,n.jsx)(l,{isOpen:t,onClose:a,className:"".concat(r[d]," ").concat(u).trim(),showCloseButton:!h,children:(0,n.jsxs)("div",{className:"w-full space-y-6 rounded-3xl p-6 sm:p-8",children:[(0,n.jsxs)("header",{className:"space-y-2",children:[(0,n.jsx)("h2",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:s}),o&&(0,n.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:o})]}),(0,n.jsx)("div",{className:"space-y-6",children:i}),c&&(0,n.jsx)("footer",{className:"flex flex-col gap-3 sm:flex-row sm:justify-end",children:c})]})})}},56165:(e,t,a)=>{Promise.resolve().then(a.bind(a,16256))},57451:(e,t,a)=>{"use strict";a.r(t),a.d(t,{ToastProvider:()=>h,useToast:()=>u});var n=a(95155),s=a(12115),l=a(40646),r=a(85339),o=a(1243),i=a(81284),c=a(54416);let d=(0,s.createContext)(void 0);function h(e){let{children:t}=e,[a,l]=(0,s.useState)([]),r=(0,s.useCallback)(e=>{l(t=>t.filter(t=>t.id!==e))},[]),o=(0,s.useCallback)(function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3,n=Math.random().toString(36).substring(2,9),s={id:n,type:e,message:t,duration:a};console.log("\uD83D\uDD14 Adding toast:",s),l(e=>{let t=[...e,s];return console.log("\uD83D\uDCCB All toasts:",t),t}),a>0&&setTimeout(()=>{r(n)},a)},[r]),i=(0,s.useCallback)((e,t)=>o("success",e,t),[o]),c=(0,s.useCallback)((e,t)=>o("error",e,t),[o]),h=(0,s.useCallback)((e,t)=>o("warning",e,t),[o]),u=(0,s.useCallback)((e,t)=>o("info",e,t),[o]);return(0,n.jsxs)(d.Provider,{value:{toasts:a,addToast:o,removeToast:r,success:i,error:c,warning:h,info:u},children:[t,(0,n.jsx)(x,{toasts:a,removeToast:r})]})}function u(){let e=(0,s.useContext)(d);if(!e)throw Error("useToast must be used within ToastProvider");return e}function x(e){let{toasts:t,removeToast:a}=e;return console.log("\uD83C\uDFAF ToastContainer rendering with toasts:",t.length),(0,n.jsx)("div",{className:"fixed top-4 right-4 flex flex-col gap-2 max-w-sm pointer-events-none",style:{zIndex:999999},children:t.map(e=>(0,n.jsx)("div",{className:"pointer-events-auto",children:(0,n.jsx)(m,{toast:e,onClose:()=>a(e.id)})},e.id))})}function m(e){let{toast:t,onClose:a}=e,s=(()=>{switch(t.type){case"success":return{bg:"bg-green-50 dark:bg-green-900/20",border:"border-green-500",text:"text-green-800 dark:text-green-200",icon:(0,n.jsx)(l.A,{className:"w-5 h-5 text-green-600 dark:text-green-400"})};case"error":return{bg:"bg-red-50 dark:bg-red-900/20",border:"border-red-500",text:"text-red-800 dark:text-red-200",icon:(0,n.jsx)(r.A,{className:"w-5 h-5 text-red-600 dark:text-red-400"})};case"warning":return{bg:"bg-yellow-50 dark:bg-yellow-900/20",border:"border-yellow-500",text:"text-yellow-800 dark:text-yellow-200",icon:(0,n.jsx)(o.A,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400"})};case"info":return{bg:"bg-blue-50 dark:bg-blue-900/20",border:"border-blue-500",text:"text-blue-800 dark:text-blue-200",icon:(0,n.jsx)(i.A,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}}})();return(0,n.jsxs)("div",{className:"".concat(s.bg," ").concat(s.border," ").concat(s.text," border-l-4 rounded-lg shadow-lg p-4 flex items-start gap-3 min-w-[320px] animate-slideIn"),children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:s.icon}),(0,n.jsx)("p",{className:"flex-1 text-sm font-medium",children:t.message}),(0,n.jsx)("button",{onClick:a,className:"flex-shrink-0 hover:opacity-70 transition-opacity",children:(0,n.jsx)(c.A,{className:"w-4 h-4"})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[3758,2960,6460,431,3613,5018,8441,1684,7358],()=>t(56165)),_N_E=e.O()}]);